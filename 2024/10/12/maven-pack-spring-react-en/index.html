<html>
<head>
	
	<title>Maven Packages Spring Boot and React into the Same Application</title>
	<meta name="keywords" content="Chris LEE,心神合一" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css" />

        
<script src="/js/util.js"></script>

        <script>
            if(isMobile()) {
                loadjscssfile('/css/mobile.css', 'css');
            } else {
                loadjscssfile('/css/desktop.css', 'css');
            }
        </script>
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"/>
    
    

<meta name="generator" content="Hexo 7.3.0"></head>

<body>


<h2 class="title">Maven Packages Spring Boot and React into the Same Application</h2>
<!--
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2024年10月12日




 </div>
-->
</div>

<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-a-Spring-Boot-Project"><span class="toc-text">Creating a Spring Boot Project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-a-React-Project-Module"><span class="toc-text">Creating a React Project Module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debugging-Front-end-and-Back-end"><span class="toc-text">Debugging Front-end and Back-end</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Packaging-React-into-Spring-Boot"><span class="toc-text">Packaging React into Spring Boot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Automating-React-Compilation-Before-Maven-Packaging"><span class="toc-text">Automating React Compilation Before Maven Packaging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Testing-the-WAR-File"><span class="toc-text">Testing the WAR File</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fixing-the-404-Error-After-Refreshing-the-Page-in-React-Router"><span class="toc-text">Fixing the 404 Error After Refreshing the Page in React Router</span></a></li></ol>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>In medium to large enterprises, it is common not to use the built-in Tomcat or other servers in Spring Boot. Instead, the application is packaged into a WAR file and deployed to enterprise-level web containers (JBoss, WebLogic, WebSphere, Liberty, etc.) because the built-in Tomcat container has weak performance or does not meet enterprise standards. When packaging, we can place the front-end files generated by <code>npm build</code> into the <code>static</code> folder of Spring Boot, and finally package them into a single WAR file.</p>
<p>This article has the following goals:</p>
<ol>
<li>Create a Spring Boot and React project in IntelliJ IDEA.</li>
<li>Debug the front-end and back-end, configure Proxy to solve cross-origin issues.</li>
<li>Package Spring Boot and React into a WAR file.</li>
<li>Fix the 404 error after refreshing the page.</li>
</ol>
<h2 id="Creating-a-Spring-Boot-Project"><a href="#Creating-a-Spring-Boot-Project" class="headerlink" title="Creating a Spring Boot Project"></a>Creating a Spring Boot Project</h2><img src="./create-pokemon.png" width=600 />

<p>After creation, we notice two differences compared to applications with built-in Tomcat:</p>
<ol>
<li>In <code>pom.xml</code>, the output file format is WAR instead of JAR, and a Tomcat dependency is added with the scope set to <code>provided</code>. This means the dependency is referenced during the compilation phase but not packaged into the WAR file, as the external web container where the WAR file will be deployed will provide this dependency. Using the Tomcat dependency does not mean the generated WAR file can only be deployed in Tomcat; during development, we only use the Servlet API included in this dependency.<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>A new <code>ServletInitializer.java</code> file is added. <code>ServletInitializer</code> is the entry point for the web container to start Spring Boot from the WAR file, while <code>PokemonApplication</code> is the entry point for starting Spring Boot (and thus the built-in Tomcat) from a JAR file. In the WAR file, Spring Boot is not started from <code>PokemonApplication</code>, so it can be deleted.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.chris.pokemon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.support.SpringBootServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletInitializer</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> application.sources(PokemonApplication.class);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="./app-entrances.png" /></li>
</ol>
<p>Usually, IntelliJ IDEA has already created an artifact of type <code>web exploded</code>. If not, create one manually.<br><img src="./artifacts.png" width=800 /></p>
<p>During development, choose a lightweight Tomcat for faster startup. In <code>Edit Configurations...</code>, create a Tomcat Server and select <code>Local</code>. Add the artifact to the <code>Deployment</code> tab.</p>
<p><strong>Note: Change the <code>/pokemon_war_exploded</code> in the Application Context to <code>/</code>. Otherwise, your root path will be <code>http://localhost:8080/pokemon_war_exploded</code> instead of <code>http://localhost:8080/</code>.</strong></p>
<p>If multiple applications are running in the same Tomcat, different contexts can be used to distinguish them. However, since we only have one, we use <code>/</code>.<br><img src="./tomcat-deployment.png" width=800 /></p>
<p>In the <code>Server</code> panel, set both <code>On &#39;Update&#39; Action</code> and <code>On frame deactivation</code> to <code>Update classes and resources</code>. This allows automatic updates after modifying the code without restarting Tomcat. <strong>Note: Hot code updates only succeed when modifying the internal logic of methods. If the class structure is modified (e.g., adding, deleting, or modifying classes, fields, methods, or changing method parameters), hot updates will fail, and Tomcat must be restarted.</strong> In <code>After launch</code>, you can set your preferred browser to open automatically after Tomcat starts successfully.<br><img src="./tomcat-settings.png" width=800 /></p>
<p>Start the server. If you see Spring outputting information in the console, the startup is successful.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"></span><br><span class="line"> :: Spring Boot ::                (v3.3.4)</span><br><span class="line"></span><br><span class="line">2024-10-13T10:38:33.587+08:00  INFO 9147 --- [pokemon] [on(2)-127.0.0.1] org.chris.pokemon.ServletInitializer     : Starting ServletInitializer v0.0.1-SNAPSHOT using Java 23 with PID 9147 (/Users/chris/IdeaProjects/pokemon/target/pokemon-0.0.1-SNAPSHOT/WEB-INF/classes started by chris in /Users/chris/Work/IdeaProjects/libs/apache-tomcat-10.0.12/bin)</span><br><span class="line">2024-10-13T10:38:33.590+08:00  INFO 9147 --- [pokemon] [on(2)-127.0.0.1] org.chris.pokemon.ServletInitializer     : No active profile set, falling back to 1 default profile: &quot;default&quot;</span><br><span class="line">2024-10-13T10:38:34.504+08:00  INFO 9147 --- [pokemon] [on(2)-127.0.0.1] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 856 ms</span><br><span class="line">2024-10-13T10:38:35.191+08:00  INFO 9147 --- [pokemon] [on(2)-127.0.0.1] org.chris.pokemon.ServletInitializer     : Started ServletInitializer in 2.063 seconds (process running for 4.649)</span><br><span class="line">[2024-10-13 10:38:35,232] Artifact pokemon:war exploded: Artifact is deployed successfully</span><br><span class="line">[2024-10-13 10:38:35,233] Artifact pokemon:war exploded: Deploy took 3,575 milliseconds</span><br><span class="line">2024-10-13T10:38:35.751+08:00  INFO 9147 --- [pokemon] [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet &#x27;dispatcherServlet&#x27;</span><br><span class="line">2024-10-13T10:38:35.752+08:00  INFO 9147 --- [pokemon] [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms</span><br></pre></td></tr></table></figure>
<p>If you only see the following information, it means the Tomcat artifact deployment was successful, but Spring Boot did not start.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[2024-10-13 10:40:45,583] Artifact pokemon:war exploded: Artifact is deployed successfully</span><br><span class="line">[2024-10-13 10:40:45,583] Artifact pokemon:war exploded: Deploy took 1,221 milliseconds</span><br></pre></td></tr></table></figure>
<p>In the <code>Tomcat Catalina Log</code> tab, you will see the following warning:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13-Oct-2024 10:45:44.580 WARNING [RMI TCP Connection(2)-127.0.0.1] org.apache.tomcat.util.descriptor.web.WebXml.setVersion Unknown version string [5.0]. Default version will be used.</span><br></pre></td></tr></table></figure>
<p>This error occurs because lower versions of Tomcat do not support higher versions of Spring Boot. I encountered this issue when deploying Spring Boot 3.3.4 with Tomcat 8.5.76. Changing to Tomcat 10.0.12 allowed Spring Boot to start successfully.</p>
<h2 id="Creating-a-React-Project-Module"><a href="#Creating-a-React-Project-Module" class="headerlink" title="Creating a React Project Module"></a>Creating a React Project Module</h2><p>In <code>Project Structure</code>, under <code>Module</code>, click <code>New Module</code>, select a React project, and name it <code>web</code>.<br><img src="./new-react-module.png" width=800 /></p>
<p>After clicking <code>OK</code>, wait for a while (usually very slow). You can go grab a coffee.</p>
<p>Once the React project is created, a <code>web</code> folder will be created. In <code>Edit Configurations...</code>, add <code>npm</code>, select the <code>start</code> command, and click <code>OK</code> to start.<br><img src="./npm-start.png" width=800/><br>If everything goes well, you will see the following information in the console, and the browser will automatically open <code>http://localhost:3000</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Compiled successfully!</span><br><span class="line"></span><br><span class="line">You can now view web in the browser.</span><br><span class="line"></span><br><span class="line">  Local:            http://localhost:3000</span><br><span class="line">  On Your Network:  http://192.168.31.194:3000</span><br><span class="line"></span><br><span class="line">Note that the development build is not optimized.</span><br><span class="line">To create a production build, use npm run build.</span><br><span class="line"></span><br><span class="line">webpack compiled successfully</span><br></pre></td></tr></table></figure>

<img src="./react-started.png" width=800/>

<h2 id="Debugging-Front-end-and-Back-end"><a href="#Debugging-Front-end-and-Back-end" class="headerlink" title="Debugging Front-end and Back-end"></a>Debugging Front-end and Back-end</h2><p>Create a <code>domain</code> package and create a <code>Pokemon</code> class under it.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.chris.pokemon.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pokemon</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Create a <code>controller</code> package and create a <code>PokemonController</code> class under it.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.chris.pokemon.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.chris.pokemon.domain.Pokemon;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/pokemon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PokemonController</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;?&gt; list()</span><br><span class="line">	&#123;</span><br><span class="line">		List&lt;Pokemon&gt; pokemonList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		pokemonList.add(<span class="keyword">new</span> <span class="title class_">Pokemon</span>(<span class="string">&quot;Charmander&quot;</span>, <span class="string">&quot;Fire&quot;</span>));</span><br><span class="line">		pokemonList.add(<span class="keyword">new</span> <span class="title class_">Pokemon</span>(<span class="string">&quot;Squirtle&quot;</span>, <span class="string">&quot;Water&quot;</span>));</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ResponseEntity.ok(pokemonList);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>After starting, open <code>http://localhost:8080/api/pokemon/list</code> to get the following response:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Charmander&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Fire&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Squirtle&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Water&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>Modify <code>web/src/App.js</code> to the following code to attempt to fetch data from the back-end and display it.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useEffect, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [pokemonList, setPokemonList] = <span class="title function_">useState</span>([]);</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&#x27;http://localhost:8080/api/pokemon/list&#x27;</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="title function_">setPokemonList</span>(data));</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>Pokemon List:<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;pokemonList.map(pokemon =&gt; <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;pokemon.name&#125;</span>&gt;</span>&#123;pokemon.name&#125; (&#123;pokemon.type&#125;)<span class="tag">&lt;/<span class="name">li</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>
<p>Refresh the React page, but unfortunately, it fails. Open the browser’s developer tools and see an error message in the Console.<br><img src="./fetch-error.png" width=800/></p>
<p>In the Network tab, you can see a CORS error when fetching data:</p>
<img src="./dev-tool-network-cors.png" width=800/>

<p>What’s going on? The browser’s security policy does not allow cross-origin requests. <code>http://localhost:3000</code> and <code>http://localhost:8080</code> are considered different origins. There are many solutions to cross-origin issues, but the simplest way in this project is to forward the request to <code>http://localhost:8080</code>. This way, we only need to access <code>http://localhost:3000</code>.</p>
<p>Create a <code>setupProxy.js</code> file in <code>web/src/</code>. The code below forwards all requests starting with <code>/api</code> to <code>http://localhost:8080</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;createProxyMiddleware&#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="title function_">use</span>(</span><br><span class="line">        <span class="string">&#x27;/api&#x27;</span>, <span class="comment">// Specify the requests to be forwarded</span></span><br><span class="line">        <span class="title function_">createProxyMiddleware</span>(&#123;</span><br><span class="line">            <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span>, <span class="comment">// Server address</span></span><br><span class="line">            <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, change the request in <code>App.js</code> from <code>http://localhost:8080/api/pokemon/list</code> to <code>/api/pokemon/list</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useEffect, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [pokemonList, setPokemonList] = <span class="title function_">useState</span>([]);</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&#x27;/api/pokemon/list&#x27;</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="title function_">setPokemonList</span>(data));</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>Pokemon List:<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;pokemonList.map(pokemon =&gt; <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;pokemon.name&#125;</span>&gt;</span>&#123;pokemon.name&#125; (&#123;pokemon.type&#125;)<span class="tag">&lt;/<span class="name">li</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>
<p>Restart <code>npm</code> and refresh the page. We successfully fetched the data. In the Network panel, we can see that the request URL is <code>http://localhost:3000/api/pokemon/list</code>, and the Proxy forwarded the request to <code>http://localhost:8080/api/pokemon/list</code>.<br><img src="./proxy-works.png" width=800/></p>
<h2 id="Packaging-React-into-Spring-Boot"><a href="#Packaging-React-into-Spring-Boot" class="headerlink" title="Packaging React into Spring Boot"></a>Packaging React into Spring Boot</h2><p>In <code>Edit Configurations...</code>, add an <code>npm run build</code> configuration. Select <code>run</code> for the Command and <code>build</code> for the scripts.<br><img src="./npm-run-build.png" width=800/></p>
<p>After adding, run the build. <code>npm</code> will place the compiled React files in the <code>web/build</code> folder. You can place all the files under <code>build</code> (excluding the <code>build</code> folder) on an HTTP server to run the React application. However, we do not want to deploy two web servers in production. The back-end web container also has the ability to serve static resources, so we can manage the React files together with Spring Boot.</p>
<p>Copy all files from <code>web/build/</code> to <code>src/main/resources/static/</code>. Restart Tomcat and open <code>http://localhost:8080</code>. You will see that React runs normally and successfully fetches the data.<br><img src="./copy-react-build-to-spring-boot-static.png" width=800/><br><img src="./react-in-spring-boot.png" width=800/></p>
<p>Clicking <code>package</code> under <code>Lifecycle</code> in the Maven panel will package Spring Boot into a WAR file. You can find <code>pokemon-0.0.1-SNAPSHOT.war</code> under the <code>target</code> folder. Deploy this WAR file to the production environment’s web container to run it.<br><img src="./generated-war.png" width=800/></p>
<p>The packaging process requires the following three steps:</p>
<ol>
<li>Run <code>npm run build</code> to compile React into <code>web/build/</code>.</li>
<li>Copy all files from <code>web/build/</code> to <code>src/main/resources/static/</code>.</li>
<li>Run Maven’s <code>package</code> command to generate the WAR file.</li>
</ol>
<p>Why not automate these three steps so that Maven automatically executes the first two steps during packaging?</p>
<h2 id="Automating-React-Compilation-Before-Maven-Packaging"><a href="#Automating-React-Compilation-Before-Maven-Packaging" class="headerlink" title="Automating React Compilation Before Maven Packaging"></a>Automating React Compilation Before Maven Packaging</h2><p>To make Maven run the <code>npm run build</code> command and copy the compiled front-end files, we need to add two Maven plugins: <code>exec-maven-plugin</code> to run commands and <code>maven-resources-plugin</code> to copy files. Add the following two plugin tags under the <code>project → build → plugins</code> node in <code>pom.xml</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Plugin to run npm commands --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>exec-npm-run-build<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-resources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executable</span>&gt;</span>npm<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">arguments</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">argument</span>&gt;</span>run<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">argument</span>&gt;</span>build<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">workingDirectory</span>&gt;</span>$&#123;project.basedir&#125;/web<span class="tag">&lt;/<span class="name">workingDirectory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Plugin to copy built files to static folder in WAR --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>process-resources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- WAR projects put static resources in webapp directory --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/classes/static<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/web/build/<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Clear the front-end files copied to <code>src/main/resources/static/</code> in the previous step, as the plugin will copy the front-end files to <code>target/classes/static/</code> and package them. There is no need to copy them to <code>src/main/resources/static/</code> first.</p>
<p>To prevent residual files from causing issues, usually click <code>clean</code> under <code>Lifecycle</code> in the Maven panel to clean the <code>target</code> folder, then click <code>package</code>. After a short wait, you can find the WAR file in the <code>target</code> folder. Make a copy of the WAR file, change its extension to <code>.zip</code>, and open it with a compression tool. You will see that the React files have been copied to <code>WEB-INF/classes/static/</code> in the WAR file.<br><img src="./war-zip-preview.png" width=800/></p>
<h2 id="Testing-the-WAR-File"><a href="#Testing-the-WAR-File" class="headerlink" title="Testing the WAR File"></a>Testing the WAR File</h2><p>In <code>Edit Configurations…</code>, select <code>Tomcat</code>, click the <code>Copy Configuration</code> button to duplicate the Tomcat configuration, and add <code>Test</code> to the name. In the <code>Deployment</code> tab, delete the <code>web exploded</code> artifact, add <code>External Source...</code>, select the WAR file in the <code>target</code> directory, and change the <code>Application context</code> to <code>/</code>.<br><img src="./duplicate-tomcat.png" width=800/><br><img src="./external-war-in-tomcat.png" width=800/><br>Save and run. The WAR file runs successfully.<br><img src="./react-in-spring-boot.png" width=800/></p>
<h2 id="Fixing-the-404-Error-After-Refreshing-the-Page-in-React-Router"><a href="#Fixing-the-404-Error-After-Refreshing-the-Page-in-React-Router" class="headerlink" title="Fixing the 404 Error After Refreshing the Page in React Router"></a>Fixing the 404 Error After Refreshing the Page in React Router</h2><p>This issue does not occur when you run <code>npm</code> and Tomcat locally, but when you package the application into a WAR file and deploy it to a web container, users may encounter a 404 error after clicking a link and refreshing the page. Let’s reproduce this error.</p>
<p>In the <code>Terminal</code> panel of IntelliJ IDEA, execute the following commands. First, navigate to the <code>web</code> directory, then install <code>react-router</code> and <code>react-router-dom</code>. Note: The <code>npm</code> command must be run in the directory containing <code>package.json</code>.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> web</span><br><span class="line">npm install --save react-router-dom</span><br></pre></td></tr></table></figure>
<p>Modify <code>web/src/index.js</code> to add the <code>BrowserRouter</code> tag:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reportWebVitals <span class="keyword">from</span> <span class="string">&#x27;./reportWebVitals&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">App</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you want to start measuring performance in your app, pass a function</span></span><br><span class="line"><span class="comment">// to log results (for example: reportWebVitals(console.log))</span></span><br><span class="line"><span class="comment">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</span></span><br><span class="line"><span class="title function_">reportWebVitals</span>();</span><br></pre></td></tr></table></figure>

<p>Modify <code>src/App.js</code> to use routing to define two paths and two components:</p>
<ol>
<li>The root path <code>/</code> corresponds to the React component <code>Home</code>.</li>
<li><code>/about</code> corresponds to the React component <code>About</code>.</li>
</ol>
<p>In actual development, you can place <code>Home</code> and <code>About</code> in different files, export them using <code>export</code>, and only keep the routing in <code>App</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useEffect, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Routes</span>, <span class="title class_">Route</span>, <span class="title class_">Link</span>&#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [pokemonList, setPokemonList] = <span class="title function_">useState</span>([]);</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&#x27;/api/pokemon/list&#x27;</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="title function_">setPokemonList</span>(data));</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>Pokemon List:<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;pokemonList.map(pokemon =&gt; <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;pokemon.name&#125;</span>&gt;</span>&#123;pokemon.name&#125; (&#123;pokemon.type&#125;)<span class="tag">&lt;/<span class="name">li</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">About</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Field Guide of Pokemon<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;about&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">About</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>Open <code>http://localhost:3000/</code> to display the home page with an <code>About</code> link. Clicking <code>About</code> opens a new page, and the URL changes to <code>http://localhost:3000/about</code>. Refreshing the <code>About</code> page also displays correctly.<br><img src="./react-router-home.png" width=800/><br><img src="./react-router-about.png" width=800/></p>
<p>Now, let’s package the application into a WAR file, deploy it to <code>Tomcat Test</code>, and start it. Refresh the browser on the <code>About</code> page, and you will see a 404 error.<br><img src="./refresh-error.png" width=800/></p>
<p>What’s going on?</p>
<p>React is a Single Page Application (SPA). The browser only loads the <code>index.html</code> page throughout the entire session. The content and changes users see are achieved by JavaScript modifying the DOM of <code>index.html</code>. Communication with the server is done through JSON, and new components are rendered locally in the browser.</p>
<p>When we open <code>http://localhost:8080/</code>, we request the resource at path <code>/</code> from Tomcat. Tomcat defaults to serving <code>index.html</code> from <code>static/</code>, which is the initial page of React. The content is a blank page, and React loads JavaScript to render the <code>Home</code> component and display the content. When you click the <code>About</code> link, React Router removes the <code>Home</code> component and displays the <code>About</code> component’s content, modifying the URL without requesting a new page from Tomcat.</p>
<p>When you click the browser’s refresh button, the browser requests the resource at path <code>/about</code> from the server. However, the server does not have <code>/about</code> defined in the Controller, nor does it have a static resource named <code>about</code> in <code>static/</code>. Therefore, it returns a 404 error.</p>
<p>In Spring MVC, resource responses have a priority: first, dynamic resources from the Controller are sought, then static resources from <code>static/</code>. If no static resource is found, a 404 error is returned.</p>
<p>To solve this, we can return <code>index.html</code> by default when no static resource is found. React Router will render the corresponding page based on the browser’s URL.</p>
<p>To implement this logic, we need to add <code>ResourceHandlers</code> in Spring MVC.</p>
<p>Add the following line to <code>application.properties</code> to specify the location of static resources:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.web.resources.static-locations</span>=<span class="string">classpath:/static/</span></span><br></pre></td></tr></table></figure>

<p>Create a <code>configuration</code> package and create a <code>WebMvcConfiguration</code> class with the following code. Any path that does not find a resource will return <code>index.html</code>. The back-end will no longer return 404 errors, and paths that do not find resources will be handled by React Router on the front-end.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.chris.pokemon.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.resource.PathResourceResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;spring.web.resources.static-locations&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String staticLocations;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span></span><br><span class="line">	&#123;</span><br><span class="line">		registry.addResourceHandler(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">				.addResourceLocations(staticLocations)</span><br><span class="line">				.resourceChain(<span class="literal">true</span>)</span><br><span class="line">				.addResolver(<span class="keyword">new</span> <span class="title class_">PathResourceResolver</span>()</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="meta">@Override</span></span><br><span class="line">					<span class="keyword">protected</span> Resource <span class="title function_">getResource</span><span class="params">(String resourcePath, Resource location)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="built_in">super</span>.getResource(resourcePath, location);</span><br><span class="line">						<span class="keyword">return</span> resource == <span class="literal">null</span> ? <span class="built_in">super</span>.getResource(<span class="string">&quot;index.html&quot;</span>, location) : resource;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Repackage and redeploy. After refreshing the <code>About</code> page, there is no 404 error, and the <code>About</code> page displays correctly.</p>
<img src="./refresh-error-resolved.png" width=800/>

<p><strong>End of Article</strong></p>


<!--<a href="https://blog.chrislee.fun/2024/10/12/maven-pack-spring-react-en/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
</div>






</body>
</html>